<!DOCTYPE html>
{% load static %}
<html>
  <head>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  </head>

  <body>
        <div id="machines" class="out">
        </div>
  </body>

  <script>
  window.onload=function()
  {
    var machines = document.getElementById('machines');
    var i=1;
      {% for machine in machines %}
      //div for machine overall
      var machine = document.createElement("div");
      var name = "machine"+i;
      machine.setAttribute("id", "machine"+i);

      //image for machine
      var machine_picture = document.createElement("img")

      //Check threat level and match it with the right image
      if({{machine.number_of_threats}} == 0)
      {
        machine_picture.setAttribute("src", "{% static "green-square" %}");
      }

      if({{machine.number_of_threats}} == 1)
      {
        machine_picture.setAttribute("src", "{% static "yellow-square" %}");
      }

      if({{machine.number_of_threats}} == 2)
      {
        machine_picture.setAttribute("src", "{% static "orange-square" %}");
      }

      if({{machine.number_of_threats}} == 3)
      {
        machine_picture.setAttribute("src", "{% static "red-square" %}");
      }
      machine_picture.setAttribute("height", "100");
      machine_picture.setAttribute("width", "60");
      machine_picture.setAttribute("onclick" , "hideDescription(" + i + ")");

      //div for machine info
      var machine_info = document.createElement("div");
      machine_info.setAttribute("id", "machine_info"+i);
      machine_info.innerHTML="{{machine.name}}\n{{machine.ip}}";

      //Append machine info and image to a machine
      machine.appendChild(machine_picture);
      machine.appendChild(machine_info);
      //Append machine to machines
      machines.appendChild(machine);

      //make each machine draggable
      $(document).ready(function() {
        $("#machine"+i).draggable();
        $("#machines"+i).draggable({
          stop: function(event, ui) {
            var left = ui.position.left;
            var top = ui.position.top;

            left = left - left % 10;
            top = top - top % 10;
            $("#machines"+i).offset({left:left,top:top});
    console.log($("#machines"+i).position());
     }
    });
      });

      i++;
      {%endfor%}

  }

  </script>
  <script type="text/javascript">
  function hideDescription(computerID){
    var DescriptionElement = "#machine_info" +computerID;
    $(DescriptionElement).toggleClass("hidden");
  }
  </script

</html>
